<div class="flex flex-col justify-center gap-5">
  <div
    class="background-div h-40 max-w-full md:h-60 relative mx-10 overflow-hidden rounded-3xl shadow"
  >
    <div
      class="flex justify-center items-center py-6 px-2 md:flex md:w-3/5 md:py-10 md:pl-10"
    >
      <div class="flex justify-center items-center">
        <div
          class="size-28 md:size-40 rounded-full bg-gray-sonar flex justify-center items-center"
        >
          <p
            class="text-white text-6xl bg-primary rounded-full size-24 md:size-36 flex justify-center items-center"
          >
            {{
              connectedUser()?.firstName?.slice(0, 1) ||
                connectedUser()?.name?.slice(0, 1)
            }}
          </p>
        </div>
      </div>

      <div class="flex flex-col mx-2 w-1/2">
        <p class="flex text-[8px] md:text-sm text-white font-light">
          {{ connectedUser()?.comptePrincipal?.username }}
        </p>
        <p class="flex text-lg leading-none md:text-3xl text-white font-bold">
          {{ connectedUser()?.firstName }}
        </p>
        <p class="flex text-lg leading-none md:text-3xl text-white font-bold">
          {{ connectedUser()?.name }}
        </p>
        <p class="flex text-[8px] md:text-lg text-white font-light">
          {{ connectedUser()?.email }}
        </p>
      </div>
    </div>

    <div
      class="absolute bottom-2 right-2 size-5 bg-white rounded-full flex justify-center items-center"
    >
      <hlm-icon class="w-3" name="lucideEdit" />
    </div>
  </div>

  <div
    class="bg-gray-sonar flex flex-col-reverse md:flex-col mx-10 md:w-3/5 rounded-3xl"
  >
    <div class="flex justify-between md:pt-5 px-5">
      <p class="text-xl font-bold hidden md:block">Informations</p>
      <div class="flex flex-col md:px-0 md:pb-0 justify-center w-full md:w-fit">
        <hlm-dialog class="flex pb-2 justify-start w-full">
          <button
            class="rounded-full text-xs w-auto hidden md:flex md:text-base justify-end"
            id="edit-profile"
            brnDialogTrigger
            hlmBtn
          >
            Modifier le profil
          </button>
          <hlm-dialog-content
            class="p-6 rounded-xl m-4 w-11/12 md:max-w-lg"
            *brnDialogContent="let ctx"
          >
            <hlm-dialog-header>
              <h3 hlmDialogTitle>Modifier le profil</h3>
              <p class="text-xs md:text-base" hlmDialogDescription>
                Apportez des modifications à votre profil ici. Cliquez sur
                "Enregistrer" lorsque vous avez terminé.
              </p>
            </hlm-dialog-header>
            <form
              [formGroup]="updateUserForm"
              class="py-4 grid gap-4"
              (ngSubmit)="updateUser(ctx)"
            >
              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="username"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >Username</label
                >
                <input
                  formControlName="username"
                  hlmInput
                  id="username"
                  placeholder="Votre nom d'utilisateur"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>

              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="lastname"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >Nom</label
                >
                <input
                  formControlName="name"
                  hlmInput
                  id="lastname"
                  placeholder="Votre nom de famille"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>

              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="firstname"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >Prénom</label
                >
                <input
                  formControlName="firstName"
                  hlmInput
                  id="firstname"
                  placeholder="Votre prénom"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>

              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="nationalNumber"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >Numéro national</label
                >
                <input
                  formControlName="numeroNational"
                  hlmInput
                  id="nationalNumber"
                  placeholder="Ex: 90.01.01-123.45"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>

              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="phone"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >Téléphone</label
                >
                <input
                  formControlName="telephone"
                  hlmInput
                  id="phone"
                  placeholder="Votre numéro de téléphone"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>

              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="email"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >E-mail</label
                >
                <input
                  formControlName="email"
                  hlmInput
                  type="email"
                  id="email"
                  placeholder="Votre adresse e-mail"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>

              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="iban"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >Compte bancaire</label
                >
                <input
                  formControlName="iban"
                  hlmInput
                  id="iban"
                  placeholder="Votre numéro IBAN"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>

              <div
                class="grid grid-cols-4 items-center gap-x-4 gap-y-2 *:text-sm"
              >
                <label
                  hlmLabel
                  for="address"
                  class="text-left font-medium col-span-4 md:col-span-1 md:text-right"
                  >Adresse</label
                >
                <input
                  formControlName="address"
                  hlmInput
                  id="address"
                  placeholder="Votre adresse postale"
                  class="col-span-4 md:col-span-3 rounded-md px-3 py-1.5 border focus:ring-1 focus:ring-primary focus:border-primary"
                />
              </div>
              <button
                class="w-full mt-4 md:mt-6 py-2 px-4 rounded-md text-sm font-semibold"
                hlmBtn
                type="submit"
              >
                Enregistrer
              </button>
            </form>
          </hlm-dialog-content>
          <button
            class="rounded-full text-xs w-full flex md:hidden md:text-base"
            id="edit-profile"
            brnDialogTrigger
            hlmBtn
          >
            Modifier le profil
          </button>
        </hlm-dialog>
      </div>
    </div>

    <div class="p-5 flex flex-col gap-2">
      <div class="flex">
        <p class="font-bold text-[9px] md:text-sm w-28 md:w-56">Adresse</p>
        @if (!connectedUser()?.address) {
        <p class="text-[9px] md:text-sm text-red-500">
          Aucune adresse enregistrer cliquer sur le bouton modifier le profil
          afin d'en définir une
        </p>
        }
        <p class="text-[9px] md:text-sm">{{ connectedUser()?.address }}</p>
      </div>

      <!-- Section Connexions Externes -->
      @if(connectedUser()?.role === 'ADMIN') {
      <div class="flex items-center pt-2 border-t border-gray-600 mt-2">
        <p class="font-bold text-[9px] md:text-sm w-28 md:w-56">Connexions</p>
        <div class="flex items-center gap-2">
          <!-- Affichage conditionnel basé sur googleId -->
          <ng-container
            *ngIf="connectedUser()?.googleId; else linkGoogleButton"
          >
            <!-- Compte Google Lié -->
            <div class="flex items-center gap-1 text-green-500">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-check-circle-fill"
                viewBox="0 0 16 16"
              >
                <path
                  d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
                />
              </svg>
              <span class="text-[9px] md:text-sm font-medium"
                >Compte Google lié</span
              >
              <!-- Bouton pour délier -->
              <button
                hlmBtn
                variant="link"
                class="p-1 h-auto text-xs text-red-500 hover:text-red-700 ml-2"
                (click)="unlinkGoogleAccount()"
                title="Délier votre compte Google"
              >
                (Délier)
              </button>
            </div>
          </ng-container>

          <ng-template #linkGoogleButton>
            <!-- Bouton pour lier le compte Google -->
            <button
              hlmBtn
              variant="outline"
              class="flex items-center gap-2 text-xs md:text-sm"
              (click)="linkGoogleAccount()"
              title="Lier votre compte Google Agenda pour synchroniser les événements"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-google"
                viewBox="0 0 16 16"
              >
                <path
                  d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z"
                />
              </svg>
              <span>Lier le compte Google</span>
            </button>
          </ng-template>
        </div>
      </div>
      <!-- FIN Section Connexions Externes -->
      }

      <!-- Section Test Calendriers Google (visible si lié) -->
      <div
        *ngIf="connectedUser()?.googleId"
        class="pt-2 border-t border-gray-600 mt-2"
      >
        <p class="font-bold text-[9px] md:text-sm w-28 md:w-56">
          Calendriers Google
        </p>
        <div class="flex flex-col gap-2">
          <button
            hlmBtn
            variant="outline"
            size="sm"
            class="w-fit"
            (click)="fetchGoogleCalendars()"
            [disabled]="isLoadingCalendars()"
          >
            <span *ngIf="!isLoadingCalendars()">Afficher mes calendriers</span>
            <span *ngIf="isLoadingCalendars()" class="flex items-center">
              <div
                class="animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full mr-2"
              ></div>
              Chargement...
            </span>
          </button>

          <!-- Zone d'affichage des résultats -->
          <div *ngIf="googleCalendarsFetchAttempted()" class="mt-2">
            <ul
              *ngIf="googleCalendars() && googleCalendars()!.length > 0"
              class="list-disc list-inside text-xs md:text-sm"
            >
              <li *ngFor="let calendar of googleCalendars()">
                {{ calendar.summary }}
              </li>
            </ul>
            <p
              *ngIf="googleCalendars() && googleCalendars()!.length === 0"
              class="text-xs md:text-sm text-gray-500"
            >
              Aucun calendrier trouvé.
            </p>
            <p
              *ngIf="googleCalendarsError()"
              class="text-xs md:text-sm text-red-500"
            >
              Erreur: {{ googleCalendarsError() }}
            </p>
          </div>
        </div>
      </div>
      <!-- FIN Section Test Calendriers Google -->

      <div class="flex pt-2 border-t border-gray-600 mt-2">
        <p class="font-bold text-[9px] md:text-sm w-28 md:w-56">
          Notifications
        </p>
        @if (notificationsSupported()) {
        <div class="flex items-center gap-2">
          <!-- Switch personnalisé sans bouton -->
          <div
            class="custom-switch cursor-pointer"
            (click)="toggleNotifications(!notificationsEnabled())"
            (keydown.enter)="toggleNotifications(!notificationsEnabled())"
            tabindex="0"
            role="switch"
            [attr.aria-checked]="notificationsEnabled()"
            [attr.aria-label]="
              notificationsEnabled()
                ? 'Désactiver les notifications'
                : 'Activer les notifications'
            "
            [class.is-processing]="isProcessingNotificationPermission()"
          >
            <div
              class="switch-track"
              [ngClass]="{
                'switch-track-active': notificationsEnabled(),
                'switch-track-inactive': !notificationsEnabled(),
                'opacity-50': isProcessingNotificationPermission()
              }"
            >
              <div
                class="switch-thumb relative"
                [ngClass]="{
                  'switch-thumb-active': notificationsEnabled(),
                  'switch-thumb-inactive': !notificationsEnabled()
                }"
              >
                <!-- Indicateur de chargement -->
                @if (isProcessingNotificationPermission()) {
                <div
                  class="h-3 w-3 absolute top-0 bottom-0 left-0 right-0 m-auto"
                >
                  <div
                    class="animate-spin h-3 w-3 border-2 border-primary rounded-full border-t-transparent"
                  ></div>
                </div>
                }
              </div>
            </div>
          </div>

          <div class="flex items-center">
            @if (notificationsEnabled()) {
            <hlm-icon
              name="lucideBell"
              class="text-green-600 w-4 h-4 md:w-5 md:h-5"
            ></hlm-icon>
            <span class="text-[9px] md:text-sm text-green-600 ml-1"
              >Activées</span
            >
            } @else {
            <hlm-icon
              name="lucideBellOff"
              class="text-red-600 w-4 h-4 md:w-5 md:h-5"
            ></hlm-icon>
            <span class="text-[9px] md:text-sm text-red-600 ml-1"
              >Désactivées</span
            >
            }
          </div>
        </div>
        } @else {
        <p class="text-[9px] md:text-sm text-red-500">
          Les notifications ne sont pas supportées par votre navigateur
        </p>
        }
      </div>

      <div class="flex">
        <p class="font-bold text-[9px] md:text-sm w-28 md:w-56">
          Numéro de téléphone
        </p>
        <p class="text-[9px] md:text-sm">{{ connectedUser()?.telephone }}</p>
      </div>

      <div class="flex">
        <p class="font-bold text-[9px] md:text-sm w-28 md:w-56">
          Numéro national
        </p>
        <p class="text-[9px] md:text-sm">
          {{ connectedUser()?.numeroNational }}
        </p>
      </div>

      <div class="flex">
        <p class="font-bold text-[9px] md:text-sm w-28 md:w-56">
          Compte bancaire
        </p>
        <p class="text-[9px] md:text-sm">{{ connectedUser()?.iban }}</p>
      </div>
    </div>
  </div>

  <!-- Nouvelle section pour les invitations de groupe -->
  <div
    class="bg-gray-sonar flex flex-col mx-10 md:w-3/5 rounded-3xl overflow-hidden"
  >
    <div class="flex justify-between px-5 py-4 border-b border-gray-200">
      <div class="flex items-center">
        <hlm-icon
          name="lucideUsers"
          class="w-5 h-5 text-primary mr-2"
        ></hlm-icon>
        <p class="text-xl font-bold">Invitations de groupe</p>
      </div>
      <div *ngIf="pendingInvitations().length > 0" class="flex items-center">
        <span class="bg-primary text-white rounded-full px-2 py-0.5 text-xs">
          {{ pendingInvitations().length }}
        </span>
      </div>
    </div>

    <div class="p-2 md:p-4">
      <!-- Loading state -->
      <div *ngIf="isLoadingInvitations()" class="flex justify-center py-6">
        <div
          class="animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"
        ></div>
      </div>

      <!-- No invitations state -->
      <div
        *ngIf="!isLoadingInvitations() && pendingInvitations().length === 0"
        class="flex flex-col items-center justify-center py-8 text-center"
      >
        <hlm-icon
          name="lucideInbox"
          class="w-12 h-12 text-gray-400 mb-3"
        ></hlm-icon>
        <p class="text-sm text-gray-500">
          Vous n'avez aucune invitation de groupe en attente
        </p>
      </div>

      <!-- List of invitations -->
      <div
        *ngIf="!isLoadingInvitations() && pendingInvitations().length > 0"
        class="space-y-3"
      >
        <div
          *ngFor="let invitation of pendingInvitations()"
          class="bg-white rounded-xl p-4 shadow-sm"
        >
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center mb-1">
                <div
                  class="w-10 h-10 rounded-full flex items-center justify-center bg-primary text-white font-bold text-sm mr-3"
                >
                  {{
                    invitation.group.username
                      ? invitation.group.username.substring(0, 2).toUpperCase()
                      : "GP"
                  }}
                </div>
                <div>
                  <h3 class="font-medium">
                    {{ invitation.group.username || "Groupe" }}
                  </h3>
                  <p class="text-xs text-gray-500">
                    Invitation reçue {{ getRelativeTime(invitation.createdAt) }}
                  </p>
                </div>
              </div>
              <p
                *ngIf="invitation.message"
                class="text-sm text-gray-600 mt-2 ml-13 italic"
              >
                "{{ invitation.message }}"
              </p>
            </div>
          </div>
          <div class="flex justify-end gap-2 mt-3">
            <button
              (click)="respondToInvitation(invitation.id, false)"
              class="py-1.5 px-4 rounded-full text-xs border border-red-500 text-red-500 hover:bg-red-50 transition-colors relative"
              [disabled]="isProcessingInvitation(invitation.id)"
            >
              <span [class.opacity-0]="isProcessingInvitation(invitation.id)"
                >Refuser</span
              >
              <div
                *ngIf="isProcessingInvitation(invitation.id)"
                class="absolute inset-0 flex items-center justify-center"
              >
                <div
                  class="animate-spin h-3 w-3 border-2 border-red-500 rounded-full border-t-transparent"
                ></div>
              </div>
            </button>
            <button
              (click)="respondToInvitation(invitation.id, true)"
              class="py-1.5 px-4 rounded-full text-xs bg-primary text-white hover:bg-primary-dark transition-colors relative"
              [disabled]="isProcessingInvitation(invitation.id)"
            >
              <span [class.opacity-0]="isProcessingInvitation(invitation.id)"
                >Accepter</span
              >
              <div
                *ngIf="isProcessingInvitation(invitation.id)"
                class="absolute inset-0 flex items-center justify-center"
              >
                <div
                  class="animate-spin h-3 w-3 border-2 border-white rounded-full border-t-transparent"
                ></div>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Nouvelle section pour les événements de l'utilisateur -->
  <div
    class="bg-gray-sonar flex flex-col mx-10 md:w-3/5 rounded-3xl overflow-hidden mt-5 events-section"
  >
    <div class="flex justify-between px-5 py-4 border-b border-gray-200">
      <div class="flex items-center">
        <hlm-icon
          name="lucideCalendar"
          class="w-5 h-5 text-primary mr-2"
        ></hlm-icon>
        <p class="text-xl font-bold">Mes événements</p>
      </div>
    </div>

    <!-- Tabs de filtrage -->
    <div class="flex border-b border-gray-200 px-1">
      <button
        *ngFor="let tab of eventTabs"
        [class.border-primary]="currentEventTab() === tab.value"
        [class.border-b-2]="currentEventTab() === tab.value"
        [class.text-primary]="currentEventTab() === tab.value"
        class="flex-1 py-3 text-xs md:text-sm font-medium transition-colors"
        (click)="filterEvents(tab.value)"
      >
        {{ tab.label }}
        <span
          *ngIf="tab.value === 'pending' && pendingEventCount() > 0"
          class="inline-flex items-center justify-center ml-1 bg-primary text-white text-xs rounded-full w-5 h-5"
        >
          {{ pendingEventCount() }}
        </span>
      </button>
    </div>

    <div class="p-2 md:p-4">
      <!-- Loading state -->
      <div *ngIf="isLoadingEvents()" class="flex justify-center py-6">
        <div
          class="animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"
        ></div>
      </div>

      <!-- Empty state -->
      <div
        *ngIf="!isLoadingEvents() && filteredEvents().length === 0"
        class="flex flex-col items-center justify-center py-8 text-center"
      >
        <hlm-icon
          name="lucideCalendarX"
          class="w-12 h-12 text-gray-400 mb-3"
        ></hlm-icon>
        <p class="text-sm text-gray-500" [ngSwitch]="currentEventTab()">
          <ng-container *ngSwitchCase="'upcoming'"
            >Vous n'avez aucun événement à venir</ng-container
          >
          <ng-container *ngSwitchCase="'past'"
            >Vous n'avez aucun événement passé</ng-container
          >
          <ng-container *ngSwitchCase="'pending'"
            >Vous n'avez aucune invitation en attente</ng-container
          >
        </p>
      </div>

      <!-- Event list -->
      <div
        *ngIf="!isLoadingEvents() && filteredEvents().length > 0"
        class="space-y-3"
      >
        <div
          *ngFor="let event of filteredEvents()"
          class="bg-white rounded-xl p-4 shadow-sm cursor-pointer hover:bg-gray-50 transition-colors"
          [attr.data-event-id]="event.id"
          (click)="navigateToEvent(event)"
          (keydown.enter)="navigateToEvent(event)"
          tabindex="0"
          role="button"
          [attr.aria-label]="'Voir les détails de l\'événement ' + event.title"
        >
          <div class="flex flex-col md:flex-row md:items-start gap-3">
            <!-- Date indicator -->
            <div
              class="flex-shrink-0 flex flex-col items-center justify-center rounded-lg bg-primary bg-opacity-10 p-2 w-16 h-16"
            >
              <span class="text-xs text-primary">{{
                formatEventDate(event.startDateTime, "month")
              }}</span>
              <span class="text-xl font-bold text-primary">{{
                formatEventDate(event.startDateTime, "day")
              }}</span>
              <span class="text-xs text-primary">{{
                formatEventDate(event.startDateTime, "time")
              }}</span>
            </div>

            <!-- Event details -->
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <h3 class="font-medium">{{ event.title }}</h3>
                <span
                  class="text-xs px-2 py-0.5 rounded-full"
                  [ngClass]="{
                    'bg-yellow-100 text-yellow-800': event.status === 'PENDING',
                    'bg-green-100 text-green-800': event.status === 'CONFIRMED',
                    'bg-red-100 text-red-800': event.status === 'CANCELLED'
                  }"
                >
                  {{ getStatusLabel(event.status) }}
                </span>
              </div>

              <p
                *ngIf="event.description"
                class="text-sm text-gray-600 mt-1 line-clamp-2"
              >
                {{ event.description }}
              </p>

              <div class="flex flex-wrap gap-y-1 mt-2">
                <div
                  *ngIf="event.location"
                  class="flex items-center text-xs text-gray-500 mr-3"
                >
                  <hlm-icon name="lucideMapPin" class="w-3 h-3 mr-1"></hlm-icon>
                  <span>{{ event.location }}</span>
                </div>
                <div class="flex items-center text-xs text-gray-500 mr-3">
                  <hlm-icon
                    name="lucideCalendar"
                    class="w-3 h-3 mr-1"
                  ></hlm-icon>
                  <span>{{
                    formatEventDate(event.startDateTime, "date")
                  }}</span>
                </div>
                <div class="flex items-center text-xs text-gray-500">
                  <hlm-icon name="lucideClock" class="w-3 h-3 mr-1"></hlm-icon>
                  <span>{{ formatEventDuration(event) }}</span>
                </div>
              </div>

              <!-- Invitation status for pending invitations -->
              <div
                *ngIf="currentEventTab() === 'pending'"
                class="mt-3 flex justify-end gap-2"
              >
                <button
                  (click)="respondToEventInvitation(event, 'DECLINED')"
                  class="py-1.5 px-4 rounded-full text-xs border border-red-500 text-red-500 hover:bg-red-50 transition-colors"
                  [disabled]="isProcessingEventResponse[event.id || '']"
                >
                  Refuser
                </button>
                <button
                  (click)="respondToEventInvitation(event, 'ACCEPTED')"
                  class="py-1.5 px-4 rounded-full text-xs bg-primary text-white hover:bg-primary-dark transition-colors"
                  [disabled]="isProcessingEventResponse[event.id || '']"
                >
                  Accepter
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
