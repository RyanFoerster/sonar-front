<div class="flex flex-col container gap-10">
  <a
    routerLink="new-quote"
    [queryParams]="{ typeOfProjet: typeOfProjet()}"
    class="rounded-full w-3/6 self-end text-[10px] font-semibold h-auto  bg-gray-sonar text-black md:flex md:justify-center md:items-center md:gap-2 md:min-w-4/5 md:px-10 md:text-lg"
    hlmBtn>Créer un nouveau devis
  </a>


  <div class="flex flex-col gap-2">
    <h2 class="text-3xl uppercase">Facturation</h2>
    <hlm-table class="w-full min-w-[400px]">
      <hlm-trow>
        <hlm-th class="w-52">N°Devis</hlm-th>
        <hlm-th class="w-60">Date</hlm-th>
        <hlm-th class="flex-1">Client</hlm-th>
        <hlm-th class="justify-end w-40">Montant</hlm-th>
        <hlm-th class="flex-1"></hlm-th>
        <hlm-th class="flex-1">Facture</hlm-th>
      </hlm-trow>

      @if(typeOfProjet() === "PRINCIPAL") {
        @for (quote of connectedUser()?.comptePrincipal?.quote!; track quote.id) {
          <hlm-trow>
            <hlm-td truncate class="font-medium w-52">{{ quote.id }}</hlm-td>
            <hlm-td class="w-60">{{ quote.quote_date | date : 'dd/MM/YYYY' }}</hlm-td>
            <hlm-td class="flex-1">{{ quote.client.name }}</hlm-td>
            <hlm-td class="flex-1">{{ quote.client.name }}</hlm-td>
            <hlm-td class="justify-end w-40">{{ quote.total | euroFormat }}</hlm-td>
            <hlm-td class="flex-1">
              <button (click)="generateQuotePDF(quote)">
                Générer le PDF du devis
              </button>
            </hlm-td>
            <hlm-td>
              @if (quote.invoice) {
                <button (click)="generateInvoicePDF(quote)">
                  Générer le PDF de la facture
                </button>
              } @else {
                <hlm-alert-dialog>
                  <button class="" id="edit-profile" variant="outline" brnAlertDialogTrigger hlmBtn>Créer la facture ?</button>
                  <hlm-alert-dialog-content *brnAlertDialogContent="let ctx">
                    <hlm-alert-dialog-header>
                      <h3 hlmAlertDialogTitle>Créer la facture ?</h3>
                      <p hlmAlertDialogDescription>
                        Cette action est irréversible.
                      </p>
                    </hlm-alert-dialog-header>
                    <hlm-alert-dialog-footer>
                      <button hlmAlertDialogCancel (click)="ctx.close()">Cancel</button>
                      <button hlmAlertDialogAction (click)="createInvoice(quote, ctx)">Créer</button>
                    </hlm-alert-dialog-footer>
                  </hlm-alert-dialog-content>
                </hlm-alert-dialog>
              }
            </hlm-td>

          </hlm-trow>
        }
      } @else if(typeOfProjet() === "GROUP"){

        @for (quote of groupAccount()?.quote; track quote.id) {
          <hlm-trow>
            <hlm-td truncate class="font-medium w-52">{{ quote.id }}</hlm-td>
            <hlm-td class="w-60">{{ quote.quote_date | date : 'dd/MM/YYYY' }}</hlm-td>
            <hlm-td class="flex-1">{{ quote.client.name }}</hlm-td>
            <hlm-td class="justify-end w-40">{{ quote.total | euroFormat }}</hlm-td>
            <hlm-td class="flex-1">
              <button (click)="generateQuotePDF(quote)">
                Générer le PDF du devis
              </button>
            </hlm-td>
            <hlm-td>
              @if (quote.invoice) {
                <button (click)="generateInvoicePDF(quote)">
                  Générer le PDF de la facture
                </button>
              } @else {
                <hlm-alert-dialog>
                  <button class="" id="edit-profile" variant="outline" brnAlertDialogTrigger hlmBtn>Créer la facture</button>
                  <hlm-alert-dialog-content *brnAlertDialogContent="let ctx">
                    <hlm-alert-dialog-header>
                      <h3 hlmAlertDialogTitle>Créer la facture</h3>
                      <p hlmAlertDialogDescription>
                        Cette action est irréversible.
                      </p>
                    </hlm-alert-dialog-header>
                    <hlm-alert-dialog-footer>
                      <button hlmAlertDialogCancel (click)="ctx.close()">Cancel</button>
                      <button hlmAlertDialogAction (click)="createInvoice(quote, ctx)">Créer</button>
                    </hlm-alert-dialog-footer>
                  </hlm-alert-dialog-content>
                </hlm-alert-dialog>
              }
            </hlm-td>

          </hlm-trow>
        }
      }

    </hlm-table>
  </div>


</div>
